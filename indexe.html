<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0d0d0d;
  color:#eaeaea;
  font-family:Segoe UI,sans-serif;
  margin:0;
}
h2{text-align:center;margin:15px}

.container{
  display:flex;
  justify-content:center;
  gap:10px;
  padding:10px;
  flex-wrap:wrap;
}

input,button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
}

input{background:#1e1e1e;color:#fff}
button{cursor:pointer}

.card{
  background:#161616;
  padding:15px;
  border-radius:12px;
  box-shadow:0 8px 25px rgba(0,0,0,.4);
  position:relative;
}

.present{background:#1f7a3f;color:#fff}
.undo{background:#444;color:#fff;border:1px solid #888}

.menu-btn{
  position:absolute;
  top:10px;
  right:10px;
  background:none;
  color:#fff;
  font-size:20px;
  padding:4px;
}

.menu-content{
  position:absolute;
  top:35px;
  right:10px;
  background:#222;
  border-radius:6px;
  overflow:hidden;
  display:none;
  z-index:10;
}

.menu-content button{
  background:none;
  color:#fff;
  padding:8px 14px;
  width:100%;
  text-align:left;
}

.menu-content button:hover{
  background:#333;
}

#cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:16px;
  padding:20px;
}

#toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#222;
  padding:12px 20px;
  border-radius:8px;
  display:none;
}
</style>
</head>

<body>

<h2>Attendance Tracker</h2>

<div class="container">
  <input id="newStudent" placeholder="New Student Name">
  <button onclick="addStudent()">Add Student</button>
</div>

<div class="container">
  <button onclick="markToday()">Mark for Today</button>
</div>

<div class="container">
  <input id="search" placeholder="Search Student" oninput="render()">
</div>

<div id="cards"></div>
<div id="toast"></div>

<script>
let students = JSON.parse(localStorage.getItem("students")) || [];
let weeks = JSON.parse(localStorage.getItem("weeks")) || [];
let currentWeek = getWeekKey();

/* ---------- UTIL ---------- */
function save(){
  localStorage.setItem("students",JSON.stringify(students));
  localStorage.setItem("weeks",JSON.stringify(weeks));
}

function toast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.style.display="block";
  setTimeout(()=>t.style.display="none",1200);
}

function getWeekKey(date=new Date()){
  const d=new Date(date);
  const year=d.getFullYear();
  const week=Math.ceil((((d-new Date(year,0,1))/86400000)+new Date(year,0,1).getDay()+1)/7);
  return `${year}-W${week}`;
}

/* ---------- STUDENT ---------- */
function addStudent(){
  const name=document.getElementById("newStudent").value.trim();
  if(!name) return;

  students.push({
    id:Date.now(),
    name,
    joinWeek:getWeekKey(),
    attendance:{}
  });

  document.getElementById("newStudent").value="";
  save();
  render();
  toast("Student added (0/0)");
}

/* ---------- DELETE ---------- */
function deleteStudent(id){
  if(!confirm("Remove student permanently?")) return;
  students = students.filter(s=>s.id!==id);
  save();
  render();
}

/* ---------- MARK TODAY ---------- */
function markToday(){
  currentWeek = getWeekKey();
  if(!weeks.includes(currentWeek)){
    weeks.push(currentWeek);
    save();
  }
  toast("Mark students who attended today");
  render();
}

/* ---------- PRESENT / UNDO ---------- */
function togglePresent(id){
  const s = students.find(st=>st.id===id);
  if(s.joinWeek > currentWeek){
    toast("Student not enrolled yet");
    return;
  }

  if(s.attendance[currentWeek]){
    delete s.attendance[currentWeek];
    toast("Attendance undone");
  } else {
    s.attendance[currentWeek] = true;
  }

  save();
  render();
}

/* ---------- ATTENDANCE ---------- */
function getAttendance(s){
  let total=0, attended=0;

  weeks.forEach(w=>{
    if(w < s.joinWeek) return;

    if(w < currentWeek || s.attendance[w]){
      total++;
      if(s.attendance[w]) attended++;
    }
  });

  return {attended,total};
}

/* ---------- MENU CONTROL ---------- */
function toggleMenu(id){
  document.querySelectorAll(".menu-content").forEach(m=>m.style.display="none");
  const menu=document.getElementById("menu-"+id);
  menu.style.display = menu.style.display==="block"?"none":"block";
}

document.addEventListener("click",e=>{
  if(!e.target.classList.contains("menu-btn")){
    document.querySelectorAll(".menu-content").forEach(m=>m.style.display="none");
  }
});

/* ---------- RENDER ---------- */
function render(){
  const search=document.getElementById("search").value.toLowerCase();
  let html="";

  students.forEach(s=>{
    if(!s.name.toLowerCase().includes(search)) return;

    const a=getAttendance(s);
    const percent=a.total?((a.attended/a.total)*100).toFixed(2):"0.00";
    const marked=s.attendance[currentWeek];

    html+=`
    <div class="card">
      <button class="menu-btn" onclick="event.stopPropagation();toggleMenu(${s.id})">â‹®</button>
      <div class="menu-content" id="menu-${s.id}">
        <button onclick="deleteStudent(${s.id})">Delete Student</button>
      </div>

      <h3>${s.name}</h3>
      <p>Attendance: ${a.attended}/${a.total}</p>
      <p>Percentage: ${percent}%</p>

      <button class="${marked?'undo':'present'}"
        onclick="togglePresent(${s.id})">
        ${marked?'Undo Present':'Mark Present'}
      </button>
    </div>`;
  });

  document.getElementById("cards").innerHTML=html;
}

render();
</script>

</body>
</html>
